import{s as de}from"./chunk-SKB7J2MH-DAST6MQT.js";import{_ as x,s as ue,g as pe,q as he,p as fe,a as ge,b as me,D as ae,E as ne,H as ye,e as Se,l as Q,b3 as B,d as U,b4 as ve,y as xe,F as be}from"./index-DlzCbjAl.js";import{p as Ce}from"./chunk-353BL4L5-BD-O6XZ9.js";import{I as we}from"./chunk-AACKK3MU-DExsiPj8.js";import{p as Le}from"./treemap-FKARHQ26-DvujwFgf.js";import{b as O}from"./defaultLocale-C4B-KCzX.js";import{o as K}from"./ordinal-Cboi1Yqb.js";import"./_baseUniq-1trwEpOE.js";import"./_basePickBy-B4U6jfE7.js";import"./clone-Dzbvtbmk.js";import"./init-Gi6I4Gst.js";function Te(e){var a=0,n=e.children,l=n&&n.length;if(!l)a=1;else for(;--l>=0;)a+=n[l].value;e.value=a}function $e(){return this.eachAfter(Te)}function Fe(e,a){let n=-1;for(const l of this)e.call(a,l,++n,this);return this}function Ne(e,a){for(var n=this,l=[n],i,s,d=-1;n=l.pop();)if(e.call(a,n,++d,this),i=n.children)for(s=i.length-1;s>=0;--s)l.push(i[s]);return this}function ke(e,a){for(var n=this,l=[n],i=[],s,d,p,g=-1;n=l.pop();)if(i.push(n),s=n.children)for(d=0,p=s.length;d<p;++d)l.push(s[d]);for(;n=i.pop();)e.call(a,n,++g,this);return this}function Ae(e,a){let n=-1;for(const l of this)if(e.call(a,l,++n,this))return l}function _e(e){return this.eachAfter(function(a){for(var n=+e(a.data)||0,l=a.children,i=l&&l.length;--i>=0;)n+=l[i].value;a.value=n})}function ze(e){return this.eachBefore(function(a){a.children&&a.children.sort(e)})}function Me(e){for(var a=this,n=Ve(a,e),l=[a];a!==n;)a=a.parent,l.push(a);for(var i=l.length;e!==n;)l.splice(i,0,e),e=e.parent;return l}function Ve(e,a){if(e===a)return e;var n=e.ancestors(),l=a.ancestors(),i=null;for(e=n.pop(),a=l.pop();e===a;)i=e,e=n.pop(),a=l.pop();return i}function Pe(){for(var e=this,a=[e];e=e.parent;)a.push(e);return a}function Re(){return Array.from(this)}function Be(){var e=[];return this.eachBefore(function(a){a.children||e.push(a)}),e}function De(){var e=this,a=[];return e.each(function(n){n!==e&&a.push({source:n.parent,target:n})}),a}function*Ee(){var e=this,a,n=[e],l,i,s;do for(a=n.reverse(),n=[];e=a.pop();)if(yield e,l=e.children)for(i=0,s=l.length;i<s;++i)n.push(l[i]);while(n.length)}function ee(e,a){e instanceof Map?(e=[void 0,e],a===void 0&&(a=He)):a===void 0&&(a=Ie);for(var n=new Z(e),l,i=[n],s,d,p,g;l=i.pop();)if((d=a(l.data))&&(g=(d=Array.from(d)).length))for(l.children=d,p=g-1;p>=0;--p)i.push(s=d[p]=new Z(d[p])),s.parent=l,s.depth=l.depth+1;return n.eachBefore(qe)}function We(){return ee(this).eachBefore(Oe)}function Ie(e){return e.children}function He(e){return Array.isArray(e)?e[1]:null}function Oe(e){e.data.value!==void 0&&(e.value=e.data.value),e.data=e.data.data}function qe(e){var a=0;do e.height=a;while((e=e.parent)&&e.height<++a)}function Z(e){this.data=e,this.depth=this.height=0,this.parent=null}Z.prototype=ee.prototype={constructor:Z,count:$e,each:Fe,eachAfter:ke,eachBefore:Ne,find:Ae,sum:_e,sort:ze,path:Me,ancestors:Pe,descendants:Re,leaves:Be,links:De,copy:We,[Symbol.iterator]:Ee};function Ge(e){if(typeof e!="function")throw new Error;return e}function q(){return 0}function G(e){return function(){return e}}function Xe(e){e.x0=Math.round(e.x0),e.y0=Math.round(e.y0),e.x1=Math.round(e.x1),e.y1=Math.round(e.y1)}function Ye(e,a,n,l,i){for(var s=e.children,d,p=-1,g=s.length,c=e.value&&(l-a)/e.value;++p<g;)d=s[p],d.y0=n,d.y1=i,d.x0=a,d.x1=a+=d.value*c}function je(e,a,n,l,i){for(var s=e.children,d,p=-1,g=s.length,c=e.value&&(i-n)/e.value;++p<g;)d=s[p],d.x0=a,d.x1=l,d.y0=n,d.y1=n+=d.value*c}var Ue=(1+Math.sqrt(5))/2;function Ze(e,a,n,l,i,s){for(var d=[],p=a.children,g,c,u=0,C=0,r=p.length,b,S,v=a.value,h,m,A,k,P,E,_;u<r;){b=i-n,S=s-l;do h=p[C++].value;while(!h&&C<r);for(m=A=h,E=Math.max(S/b,b/S)/(v*e),_=h*h*E,P=Math.max(A/_,_/m);C<r;++C){if(h+=c=p[C].value,c<m&&(m=c),c>A&&(A=c),_=h*h*E,k=Math.max(A/_,_/m),k>P){h-=c;break}P=k}d.push(g={value:h,dice:b<S,children:p.slice(u,C)}),g.dice?Ye(g,n,l,i,v?l+=S*h/v:s):je(g,n,l,v?n+=b*h/v:i,s),v-=h,u=C}return d}const Je=function e(a){function n(l,i,s,d,p){Ze(a,l,i,s,d,p)}return n.ratio=function(l){return e((l=+l)>1?l:1)},n}(Ue);function Ke(){var e=Je,a=!1,n=1,l=1,i=[0],s=q,d=q,p=q,g=q,c=q;function u(r){return r.x0=r.y0=0,r.x1=n,r.y1=l,r.eachBefore(C),i=[0],a&&r.eachBefore(Xe),r}function C(r){var b=i[r.depth],S=r.x0+b,v=r.y0+b,h=r.x1-b,m=r.y1-b;h<S&&(S=h=(S+h)/2),m<v&&(v=m=(v+m)/2),r.x0=S,r.y0=v,r.x1=h,r.y1=m,r.children&&(b=i[r.depth+1]=s(r)/2,S+=c(r)-b,v+=d(r)-b,h-=p(r)-b,m-=g(r)-b,h<S&&(S=h=(S+h)/2),m<v&&(v=m=(v+m)/2),e(r,S,v,h,m))}return u.round=function(r){return arguments.length?(a=!!r,u):a},u.size=function(r){return arguments.length?(n=+r[0],l=+r[1],u):[n,l]},u.tile=function(r){return arguments.length?(e=Ge(r),u):e},u.padding=function(r){return arguments.length?u.paddingInner(r).paddingOuter(r):u.paddingInner()},u.paddingInner=function(r){return arguments.length?(s=typeof r=="function"?r:G(+r),u):s},u.paddingOuter=function(r){return arguments.length?u.paddingTop(r).paddingRight(r).paddingBottom(r).paddingLeft(r):u.paddingTop()},u.paddingTop=function(r){return arguments.length?(d=typeof r=="function"?r:G(+r),u):d},u.paddingRight=function(r){return arguments.length?(p=typeof r=="function"?r:G(+r),u):p},u.paddingBottom=function(r){return arguments.length?(g=typeof r=="function"?r:G(+r),u):g},u.paddingLeft=function(r){return arguments.length?(c=typeof r=="function"?r:G(+r),u):c},u}var Qe={nodes:[],levels:new Map,outerNodes:[],classes:new Map},V=new we(()=>structuredClone(Qe)),et=x(()=>{const e=be,a=ne();return ae({...e.treemap,...a.treemap??{}})},"getConfig"),tt=x(()=>V.records.nodes,"getNodes"),at=x((e,a)=>{const n=V.records;n.nodes.push(e),n.levels.set(e,a),a===0&&n.outerNodes.push(e),a===0&&!n.root&&(n.root=e)},"addNode"),nt=x(()=>({name:"",children:V.records.outerNodes}),"getRoot"),lt=x((e,a)=>{const n=V.records.classes,l=n.get(e)??{id:e,styles:[],textStyles:[]};n.set(e,l);const i=a.replace(/\\,/g,"§§§").replace(/,/g,";").replace(/§§§/g,",").split(";");i&&i.forEach(s=>{ve(s)&&(l?.textStyles?l.textStyles.push(s):l.textStyles=[s]),l?.styles?l.styles.push(s):l.styles=[s]}),n.set(e,l)},"addClass"),rt=x(()=>V.records.classes,"getClasses"),st=x(e=>V.records.classes.get(e)?.styles??[],"getStylesForClass"),ot=x(()=>{xe(),V.reset()},"clear"),Y={getNodes:tt,addNode:at,getRoot:nt,getConfig:et,clear:ot,setAccTitle:me,getAccTitle:ge,setDiagramTitle:fe,getDiagramTitle:he,getAccDescription:pe,setAccDescription:ue,addClass:lt,getClasses:rt,getStylesForClass:st};function le(e){if(!e.length)return[];const a=[],n=[];return e.forEach(l=>{const i={name:l.name,children:l.type==="Leaf"?void 0:[]};for(i.classSelector=l?.classSelector,l?.cssCompiledStyles&&(i.cssCompiledStyles=[l.cssCompiledStyles]),l.type==="Leaf"&&l.value!==void 0&&(i.value=l.value);n.length>0&&n[n.length-1].level>=l.level;)n.pop();if(n.length===0)a.push(i);else{const s=n[n.length-1].node;s.children?s.children.push(i):s.children=[i]}l.type!=="Leaf"&&n.push({node:i,level:l.level})}),a}x(le,"buildHierarchy");var it=x(e=>{Ce(e,Y);const a=[];for(const i of e.TreemapRows??[])i.$type==="ClassDefStatement"&&Y.addClass(i.className??"",i.styleText??"");for(const i of e.TreemapRows??[]){const s=i.item;if(!s)continue;const d=i.indent?parseInt(i.indent):0,p=ct(s),g=s.classSelector?Y.getStylesForClass(s.classSelector):[],c=g.length>0?g.join(";"):void 0,u={level:d,name:p,type:s.$type,value:s.value,classSelector:s.classSelector,cssCompiledStyles:c};a.push(u)}const n=le(a),l=x((i,s)=>{for(const d of i)Y.addNode(d,s),d.children&&d.children.length>0&&l(d.children,s+1)},"addNodesRecursively");l(n,0)},"populate"),ct=x(e=>e.name?String(e.name):"","getItemName"),dt={parse:x(async e=>{try{const n=await Le("treemap",e);Q.debug("Treemap AST:",n),it(n)}catch(a){throw Q.error("Error parsing treemap:",a),a}},"parse")},ut=10,D=10,X=25,pt=x((e,a,n,l)=>{const i=l.db,s=i.getConfig(),d=s.padding??ut,p=i.getDiagramTitle(),g=i.getRoot(),{themeVariables:c}=ne();if(!g)return;const u=p?30:0,C=ye(a),r=s.nodeWidth?s.nodeWidth*D:960,b=s.nodeHeight?s.nodeHeight*D:500,S=r,v=b+u;C.attr("viewBox",`0 0 ${S} ${v}`),Se(C,v,S,s.useMaxWidth);let h;try{const t=s.valueFormat||",";if(t==="$0,0")h=x(o=>"$"+O(",")(o),"valueFormat");else if(t.startsWith("$")&&t.includes(",")){const o=/\.\d+/.exec(t),f=o?o[0]:"";h=x(w=>"$"+O(","+f)(w),"valueFormat")}else if(t.startsWith("$")){const o=t.substring(1);h=x(f=>"$"+O(o||"")(f),"valueFormat")}else h=O(t)}catch(t){Q.error("Error creating format function:",t),h=O(",")}const m=K().range(["transparent",c.cScale0,c.cScale1,c.cScale2,c.cScale3,c.cScale4,c.cScale5,c.cScale6,c.cScale7,c.cScale8,c.cScale9,c.cScale10,c.cScale11]),A=K().range(["transparent",c.cScalePeer0,c.cScalePeer1,c.cScalePeer2,c.cScalePeer3,c.cScalePeer4,c.cScalePeer5,c.cScalePeer6,c.cScalePeer7,c.cScalePeer8,c.cScalePeer9,c.cScalePeer10,c.cScalePeer11]),k=K().range([c.cScaleLabel0,c.cScaleLabel1,c.cScaleLabel2,c.cScaleLabel3,c.cScaleLabel4,c.cScaleLabel5,c.cScaleLabel6,c.cScaleLabel7,c.cScaleLabel8,c.cScaleLabel9,c.cScaleLabel10,c.cScaleLabel11]);p&&C.append("text").attr("x",S/2).attr("y",u/2).attr("class","treemapTitle").attr("text-anchor","middle").attr("dominant-baseline","middle").text(p);const P=C.append("g").attr("transform",`translate(0, ${u})`).attr("class","treemapContainer"),E=ee(g).sum(t=>t.value??0).sort((t,o)=>(o.value??0)-(t.value??0)),te=Ke().size([r,b]).paddingTop(t=>t.children&&t.children.length>0?X+D:0).paddingInner(d).paddingLeft(t=>t.children&&t.children.length>0?D:0).paddingRight(t=>t.children&&t.children.length>0?D:0).paddingBottom(t=>t.children&&t.children.length>0?D:0).round(!0)(E),re=te.descendants().filter(t=>t.children&&t.children.length>0),W=P.selectAll(".treemapSection").data(re).enter().append("g").attr("class","treemapSection").attr("transform",t=>`translate(${t.x0},${t.y0})`);W.append("rect").attr("width",t=>t.x1-t.x0).attr("height",X).attr("class","treemapSectionHeader").attr("fill","none").attr("fill-opacity",.6).attr("stroke-width",.6).attr("style",t=>t.depth===0?"display: none;":""),W.append("clipPath").attr("id",(t,o)=>`clip-section-${a}-${o}`).append("rect").attr("width",t=>Math.max(0,t.x1-t.x0-12)).attr("height",X),W.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("class",(t,o)=>`treemapSection section${o}`).attr("fill",t=>m(t.data.name)).attr("fill-opacity",.6).attr("stroke",t=>A(t.data.name)).attr("stroke-width",2).attr("stroke-opacity",.4).attr("style",t=>{if(t.depth===0)return"display: none;";const o=B({cssCompiledStyles:t.data.cssCompiledStyles});return o.nodeStyles+";"+o.borderStyles.join(";")}),W.append("text").attr("class","treemapSectionLabel").attr("x",6).attr("y",X/2).attr("dominant-baseline","middle").text(t=>t.depth===0?"":t.data.name).attr("font-weight","bold").attr("style",t=>{if(t.depth===0)return"display: none;";const o="dominant-baseline: middle; font-size: 12px; fill:"+k(t.data.name)+"; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",f=B({cssCompiledStyles:t.data.cssCompiledStyles});return o+f.labelStyles.replace("color:","fill:")}).each(function(t){if(t.depth===0)return;const o=U(this),f=t.data.name;o.text(f);const w=t.x1-t.x0,$=6;let F;s.showValues!==!1&&t.value?F=w-10-30-10-$:F=w-$-6;const N=Math.max(15,F),y=o.node();if(y.getComputedTextLength()>N){const L="...";let T=f;for(;T.length>0;){if(T=f.substring(0,T.length-1),T.length===0){o.text(L),y.getComputedTextLength()>N&&o.text("");break}if(o.text(T+L),y.getComputedTextLength()<=N)break}}}),s.showValues!==!1&&W.append("text").attr("class","treemapSectionValue").attr("x",t=>t.x1-t.x0-10).attr("y",X/2).attr("text-anchor","end").attr("dominant-baseline","middle").text(t=>t.value?h(t.value):"").attr("font-style","italic").attr("style",t=>{if(t.depth===0)return"display: none;";const o="text-anchor: end; dominant-baseline: middle; font-size: 10px; fill:"+k(t.data.name)+"; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;",f=B({cssCompiledStyles:t.data.cssCompiledStyles});return o+f.labelStyles.replace("color:","fill:")});const se=te.leaves(),j=P.selectAll(".treemapLeafGroup").data(se).enter().append("g").attr("class",(t,o)=>`treemapNode treemapLeafGroup leaf${o}${t.data.classSelector?` ${t.data.classSelector}`:""}x`).attr("transform",t=>`translate(${t.x0},${t.y0})`);j.append("rect").attr("width",t=>t.x1-t.x0).attr("height",t=>t.y1-t.y0).attr("class","treemapLeaf").attr("fill",t=>t.parent?m(t.parent.data.name):m(t.data.name)).attr("style",t=>B({cssCompiledStyles:t.data.cssCompiledStyles}).nodeStyles).attr("fill-opacity",.3).attr("stroke",t=>t.parent?m(t.parent.data.name):m(t.data.name)).attr("stroke-width",3),j.append("clipPath").attr("id",(t,o)=>`clip-${a}-${o}`).append("rect").attr("width",t=>Math.max(0,t.x1-t.x0-4)).attr("height",t=>Math.max(0,t.y1-t.y0-4)),j.append("text").attr("class","treemapLabel").attr("x",t=>(t.x1-t.x0)/2).attr("y",t=>(t.y1-t.y0)/2).attr("style",t=>{const o="text-anchor: middle; dominant-baseline: middle; font-size: 38px;fill:"+k(t.data.name)+";",f=B({cssCompiledStyles:t.data.cssCompiledStyles});return o+f.labelStyles.replace("color:","fill:")}).attr("clip-path",(t,o)=>`url(#clip-${a}-${o})`).text(t=>t.data.name).each(function(t){const o=U(this),f=t.x1-t.x0,w=t.y1-t.y0,$=o.node(),F=4,R=f-2*F,N=w-2*F;if(R<10||N<10){o.style("display","none");return}let y=parseInt(o.style("font-size"),10);const z=8,L=28,T=.6,M=6,I=2;for(;$.getComputedTextLength()>R&&y>z;)y--,o.style("font-size",`${y}px`);let H=Math.max(M,Math.min(L,Math.round(y*T))),J=y+I+H;for(;J>N&&y>z&&(y--,H=Math.max(M,Math.min(L,Math.round(y*T))),!(H<M&&y===z));)o.style("font-size",`${y}px`),J=y+I+H;o.style("font-size",`${y}px`),($.getComputedTextLength()>R||y<z||N<y)&&o.style("display","none")}),s.showValues!==!1&&j.append("text").attr("class","treemapValue").attr("x",o=>(o.x1-o.x0)/2).attr("y",function(o){return(o.y1-o.y0)/2}).attr("style",o=>{const f="text-anchor: middle; dominant-baseline: hanging; font-size: 28px;fill:"+k(o.data.name)+";",w=B({cssCompiledStyles:o.data.cssCompiledStyles});return f+w.labelStyles.replace("color:","fill:")}).attr("clip-path",(o,f)=>`url(#clip-${a}-${f})`).text(o=>o.value?h(o.value):"").each(function(o){const f=U(this),w=this.parentNode;if(!w){f.style("display","none");return}const $=U(w).select(".treemapLabel");if($.empty()||$.style("display")==="none"){f.style("display","none");return}const F=parseFloat($.style("font-size")),R=28,N=.6,y=6,z=2,L=Math.max(y,Math.min(R,Math.round(F*N)));f.style("font-size",`${L}px`);const M=(o.y1-o.y0)/2+F/2+z;f.attr("y",M);const I=o.x1-o.x0,ie=o.y1-o.y0-4,ce=I-2*4;f.node().getComputedTextLength()>ce||M+L>ie||L<y?f.style("display","none"):f.style("display",null)});const oe=s.diagramPadding??8;de(C,oe,"flowchart",s?.useMaxWidth||!1)},"draw"),ht=x(function(e,a){return a.db.getClasses()},"getClasses"),ft={draw:pt,getClasses:ht},gt={sectionStrokeColor:"black",sectionStrokeWidth:"1",sectionFillColor:"#efefef",leafStrokeColor:"black",leafStrokeWidth:"1",leafFillColor:"#efefef",labelColor:"black",labelFontSize:"12px",valueFontSize:"10px",valueColor:"black",titleColor:"black",titleFontSize:"14px"},mt=x(({treemap:e}={})=>{const a=ae(gt,e);return`
  .treemapNode.section {
    stroke: ${a.sectionStrokeColor};
    stroke-width: ${a.sectionStrokeWidth};
    fill: ${a.sectionFillColor};
  }
  .treemapNode.leaf {
    stroke: ${a.leafStrokeColor};
    stroke-width: ${a.leafStrokeWidth};
    fill: ${a.leafFillColor};
  }
  .treemapLabel {
    fill: ${a.labelColor};
    font-size: ${a.labelFontSize};
  }
  .treemapValue {
    fill: ${a.valueColor};
    font-size: ${a.valueFontSize};
  }
  .treemapTitle {
    fill: ${a.titleColor};
    font-size: ${a.titleFontSize};
  }
  `},"getStyles"),yt=mt,At={parser:dt,db:Y,renderer:ft,styles:yt};export{At as diagram};
