const g=Symbol.for("@ts-pattern/matcher"),W=Symbol.for("@ts-pattern/isVariadic"),x="@ts-pattern/anonymous-select-key",N=e=>!!(e&&typeof e=="object"),E=e=>e&&!!e[g],l=(e,t,r)=>{if(E(e)){const n=e[g](),{matched:i,selections:o}=n.match(t);return i&&o&&Object.keys(o).forEach(a=>r(a,o[a])),i}if(N(e)){if(!N(t))return!1;if(Array.isArray(e)){if(!Array.isArray(t))return!1;let n=[],i=[],o=[];for(const a of e.keys()){const c=e[a];E(c)&&c[W]?o.push(c):o.length?i.push(c):n.push(c)}if(o.length){if(o.length>1)throw new Error("Pattern error: Using `...P.array(...)` several times in a single pattern is not allowed.");if(t.length<n.length+i.length)return!1;const a=t.slice(0,n.length),c=i.length===0?[]:t.slice(-i.length),d=t.slice(n.length,i.length===0?1/0:-i.length);return n.every((m,v)=>l(m,a[v],r))&&i.every((m,v)=>l(m,c[v],r))&&(o.length===0||l(o[0],d,r))}return e.length===t.length&&e.every((a,c)=>l(a,t[c],r))}return Reflect.ownKeys(e).every(n=>{const i=e[n];return(n in t||E(o=i)&&o[g]().matcherType==="optional")&&l(i,t[n],r);var o})}return Object.is(t,e)},f=e=>{var t,r,n;return N(e)?E(e)?(t=(r=(n=e[g]()).getSelectionKeys)==null?void 0:r.call(n))!=null?t:[]:Array.isArray(e)?K(e,f):K(Object.values(e),f):[]},K=(e,t)=>e.reduce((r,n)=>r.concat(t(n)),[]);function M(...e){if(e.length===1){const[t]=e;return r=>l(t,r,()=>{})}if(e.length===2){const[t,r]=e;return l(t,r,()=>{})}throw new Error(`isMatching wasn't given the right number of arguments: expected 1 or 2, received ${e.length}.`)}function h(e){return Object.assign(e,{optional:()=>B(e),and:t=>u(e,t),or:t=>$(e,t),select:t=>t===void 0?O(e):O(t,e)})}function k(e){return Object.assign((t=>Object.assign(t,{[Symbol.iterator](){let r=0;const n=[{value:Object.assign(t,{[W]:!0}),done:!1},{done:!0,value:void 0}];return{next:()=>{var i;return(i=n[r++])!=null?i:n.at(-1)}}}}))(e),{optional:()=>k(B(e)),select:t=>k(t===void 0?O(e):O(t,e))})}function B(e){return h({[g]:()=>({match:t=>{let r={};const n=(i,o)=>{r[i]=o};return t===void 0?(f(e).forEach(i=>n(i,void 0)),{matched:!0,selections:r}):{matched:l(e,t,n),selections:r}},getSelectionKeys:()=>f(e),matcherType:"optional"})})}const F=(e,t)=>{for(const r of e)if(!t(r))return!1;return!0},J=(e,t)=>{for(const[r,n]of e.entries())if(!t(n,r))return!1;return!0},R=(e,t)=>{const r=Reflect.ownKeys(e);for(const n of r)if(!t(n,e[n]))return!1;return!0};function u(...e){return h({[g]:()=>({match:t=>{let r={};const n=(i,o)=>{r[i]=o};return{matched:e.every(i=>l(i,t,n)),selections:r}},getSelectionKeys:()=>K(e,f),matcherType:"and"})})}function $(...e){return h({[g]:()=>({match:t=>{let r={};const n=(i,o)=>{r[i]=o};return K(e,f).forEach(i=>n(i,void 0)),{matched:e.some(i=>l(i,t,n)),selections:r}},getSelectionKeys:()=>K(e,f),matcherType:"or"})})}function s(e){return{[g]:()=>({match:t=>({matched:!!e(t)})})}}function O(...e){const t=typeof e[0]=="string"?e[0]:void 0,r=e.length===2?e[1]:typeof e[0]=="string"?void 0:e[0];return h({[g]:()=>({match:n=>{let i={[t??x]:n};return{matched:r===void 0||l(r,n,(o,a)=>{i[o]=a}),selections:i}},getSelectionKeys:()=>[t??x].concat(r===void 0?[]:f(r))})})}function _(e){return!0}function y(e){return typeof e=="number"}function b(e){return typeof e=="string"}function w(e){return typeof e=="bigint"}const z=h(s(_)),U=h(s(_)),V=z,S=e=>Object.assign(h(e),{startsWith:t=>{return S(u(e,(r=t,s(n=>b(n)&&n.startsWith(r)))));var r},endsWith:t=>{return S(u(e,(r=t,s(n=>b(n)&&n.endsWith(r)))));var r},minLength:t=>S(u(e,(r=>s(n=>b(n)&&n.length>=r))(t))),length:t=>S(u(e,(r=>s(n=>b(n)&&n.length===r))(t))),maxLength:t=>S(u(e,(r=>s(n=>b(n)&&n.length<=r))(t))),includes:t=>{return S(u(e,(r=t,s(n=>b(n)&&n.includes(r)))));var r},regex:t=>{return S(u(e,(r=t,s(n=>b(n)&&!!n.match(r)))));var r}}),P=S(s(b)),p=e=>Object.assign(h(e),{between:(t,r)=>p(u(e,((n,i)=>s(o=>y(o)&&n<=o&&i>=o))(t,r))),lt:t=>p(u(e,(r=>s(n=>y(n)&&n<r))(t))),gt:t=>p(u(e,(r=>s(n=>y(n)&&n>r))(t))),lte:t=>p(u(e,(r=>s(n=>y(n)&&n<=r))(t))),gte:t=>p(u(e,(r=>s(n=>y(n)&&n>=r))(t))),int:()=>p(u(e,s(t=>y(t)&&Number.isInteger(t)))),finite:()=>p(u(e,s(t=>y(t)&&Number.isFinite(t)))),positive:()=>p(u(e,s(t=>y(t)&&t>0))),negative:()=>p(u(e,s(t=>y(t)&&t<0)))}),q=p(s(y)),j=e=>Object.assign(h(e),{between:(t,r)=>j(u(e,((n,i)=>s(o=>w(o)&&n<=o&&i>=o))(t,r))),lt:t=>j(u(e,(r=>s(n=>w(n)&&n<r))(t))),gt:t=>j(u(e,(r=>s(n=>w(n)&&n>r))(t))),lte:t=>j(u(e,(r=>s(n=>w(n)&&n<=r))(t))),gte:t=>j(u(e,(r=>s(n=>w(n)&&n>=r))(t))),positive:()=>j(u(e,s(t=>w(t)&&t>0))),negative:()=>j(u(e,s(t=>w(t)&&t<0)))}),C=j(s(w)),D=h(s(function(e){return typeof e=="boolean"})),G=h(s(function(e){return typeof e=="symbol"})),H=h(s(function(e){return e==null})),Q=h(s(function(e){return e!=null}));var Z={__proto__:null,matcher:g,optional:B,array:function(...e){return k({[g]:()=>({match:t=>{if(!Array.isArray(t))return{matched:!1};if(e.length===0)return{matched:!0};const r=e[0];let n={};if(t.length===0)return f(r).forEach(o=>{n[o]=[]}),{matched:!0,selections:n};const i=(o,a)=>{n[o]=(n[o]||[]).concat([a])};return{matched:t.every(o=>l(r,o,i)),selections:n}},getSelectionKeys:()=>e.length===0?[]:f(e[0])})})},set:function(...e){return h({[g]:()=>({match:t=>{if(!(t instanceof Set))return{matched:!1};let r={};if(t.size===0)return{matched:!0,selections:r};if(e.length===0)return{matched:!0};const n=(o,a)=>{r[o]=(r[o]||[]).concat([a])},i=e[0];return{matched:F(t,o=>l(i,o,n)),selections:r}},getSelectionKeys:()=>e.length===0?[]:f(e[0])})})},map:function(...e){return h({[g]:()=>({match:t=>{if(!(t instanceof Map))return{matched:!1};let r={};if(t.size===0)return{matched:!0,selections:r};const n=(c,d)=>{r[c]=(r[c]||[]).concat([d])};if(e.length===0)return{matched:!0};var i;if(e.length===1)throw new Error(`\`P.map\` wasn't given enough arguments. Expected (key, value), received ${(i=e[0])==null?void 0:i.toString()}`);const[o,a]=e;return{matched:J(t,(c,d)=>{const m=l(o,d,n),v=l(a,c,n);return m&&v}),selections:r}},getSelectionKeys:()=>e.length===0?[]:[...f(e[0]),...f(e[1])]})})},record:function(...e){return h({[g]:()=>({match:t=>{if(t===null||typeof t!="object"||Array.isArray(t))return{matched:!1};var r;if(e.length===0)throw new Error(`\`P.record\` wasn't given enough arguments. Expected (value) or (key, value), received ${(r=e[0])==null?void 0:r.toString()}`);let n={};const i=(c,d)=>{n[c]=(n[c]||[]).concat([d])},[o,a]=e.length===1?[P,e[0]]:e;return{matched:R(t,(c,d)=>{const m=typeof c!="string"||Number.isNaN(Number(c))?null:Number(c),v=m!==null&&l(o,m,i),I=l(o,c,i),L=l(a,d,i);return(I||v)&&L}),selections:n}},getSelectionKeys:()=>e.length===0?[]:[...f(e[0]),...f(e[1])]})})},intersection:u,union:$,not:function(e){return h({[g]:()=>({match:t=>({matched:!l(e,t,()=>{})}),getSelectionKeys:()=>[],matcherType:"not"})})},when:s,select:O,any:z,unknown:U,_:V,string:P,number:q,bigint:C,boolean:D,symbol:G,nullish:H,nonNullable:Q,instanceOf:function(e){return h(s((function(t){return r=>r instanceof t})(e)))},shape:function(e){return h(s(M(e)))}};class X extends Error{constructor(t){let r;try{r=JSON.stringify(t)}catch{r=t}super(`Pattern matching error: no pattern matches value ${r}`),this.input=void 0,this.input=t}}const T={matched:!1,value:void 0};function ee(e){return new A(e,T)}class A{constructor(t,r){this.input=void 0,this.state=void 0,this.input=t,this.state=r}with(...t){if(this.state.matched)return this;const r=t[t.length-1],n=[t[0]];let i;t.length===3&&typeof t[1]=="function"?i=t[1]:t.length>2&&n.push(...t.slice(1,t.length-1));let o=!1,a={};const c=(m,v)=>{o=!0,a[m]=v},d=!n.some(m=>l(m,this.input,c))||i&&!i(this.input)?T:{matched:!0,value:r(o?x in a?a[x]:a:this.input,this.input)};return new A(this.input,d)}when(t,r){if(this.state.matched)return this;const n=!!t(this.input);return new A(this.input,n?{matched:!0,value:r(this.input,this.input)}:T)}otherwise(t){return this.state.matched?this.state.value:t(this.input)}exhaustive(t=Y){return this.state.matched?this.state.value:t(this.input)}run(){return this.exhaustive()}returnType(){return this}narrow(){return this}}function Y(e){throw new X(e)}export{ee as M,Z as z};
