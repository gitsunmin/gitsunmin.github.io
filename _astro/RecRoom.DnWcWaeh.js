import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{B as g}from"./Button.By2gZD6x.js";import{c as E}from"./utils.DJKLT7s1.js";import{r as n}from"./index.WFquGv8Z.js";import{M as h,z as w}from"./index.BiLbLflF.js";import{c as R}from"./createLucideIcon.H8DUYhgo.js";/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],W=R("mic",G);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["rect",{x:"14",y:"3",width:"5",height:"18",rx:"1",key:"kaeet6"}],["rect",{x:"5",y:"3",width:"5",height:"18",rx:"1",key:"1wsw3u"}]],F=R("pause",Y);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],K=R("play",$);/**
 * @license lucide-react v0.562.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],H=R("square",O),re=()=>{const[s,S]=n.useState(!1),[D,C]=n.useState(""),[v,m]=n.useState("ENDED"),b=n.useRef(null),N=n.useRef([]),o=n.useRef(null),u=n.useRef(null),l=n.useRef(null),c=n.useRef(null),x=n.useRef(null),P=n.useRef(null),d=n.useRef(null),U=async()=>{const t=await navigator.mediaDevices.getUserMedia({audio:!0});console.log("녹음 시작:",t),l.current||(l.current=new AudioContext);const r=l.current;c.current&&c.current.disconnect(),P.current=r.createMediaStreamSource(t),c.current=r.createAnalyser(),c.current.fftSize=2048,P.current.connect(c.current),L();const a=new MediaRecorder(t);b.current=a,N.current=[],a.ondataavailable=i=>{i.data.size>0&&N.current.push(i.data)},a.onstop=()=>{console.log("녹음 중지됨");const i=new Blob(N.current,{type:"audio/webm"}),p=URL.createObjectURL(i);C(p),S(!1),j();for(const f of t.getTracks())f.stop()},a.onstart=()=>{S(!0)},a.start()},_=()=>{b.current&&b.current.stop()};n.useEffect(()=>{o.current&&(o.current.onplaying=()=>{m("PLAYING")},o.current.onended=()=>{m("ENDED")},o.current.onpause=()=>{m("PAUSED")})},[]);const B=()=>{h(o.current).with(w.nonNullable,t=>{t.play(),l.current||(l.current=new AudioContext);const r=l.current;c.current||(c.current=r.createAnalyser(),c.current.fftSize=2048),!d.current&&t&&(d.current=r.createMediaElementSource(t),d.current.connect(c.current),c.current.connect(r.destination)),L()}).run()},I=()=>{h(o.current).with(w.nonNullable,t=>{t.pause(),j()}).run()},T=()=>{h(o.current).with(w.nonNullable,t=>{t.pause(),m("ENDED"),C(""),t.currentTime=0,j(),d.current&&(d.current.disconnect(),d.current=null)}).run()},L=()=>{if(!u.current||!c.current)return;const t=u.current,r=t.getContext("2d");if(!r)return;const a=c.current,i=a.frequencyBinCount,p=new Uint8Array(i),f=t.width,k=t.height,z=()=>{if(!r)return;x.current=requestAnimationFrame(z),a.getByteTimeDomainData(p),r.fillStyle="rgb(255, 255, 255)",r.fillRect(0,0,f,k),r.lineWidth=2,r.strokeStyle=s?"rgb(255, 99, 71)":"rgb(0, 123, 255)",r.beginPath();const q=f/i;let A=0;for(let y=0;y<i;y++){const M=p[y]/128*k/2;y===0?r.moveTo(A,M):r.lineTo(A,M),A+=q}r.lineTo(f,k/2),r.stroke()};z()},j=()=>{if(x.current&&(cancelAnimationFrame(x.current),x.current=null),u.current){const t=u.current.getContext("2d");t&&t.clearRect(0,0,u.current.width,u.current.height)}};return e.jsxs("article",{className:"flex flex-col items-center justify-center md:max-w-(--breakpoint-md) mx-auto",children:[e.jsxs("p",{className:"text-center text-gray-700",children:[e.jsx("strong",{className:"text-lg font-semibold",children:"음성 녹음"}),e.jsx("br",{}),e.jsx("span",{children:"녹음 기능은 저장되지 않습니다."})]}),e.jsx("div",{className:"w-full mt-4 mb-2",children:e.jsx("canvas",{ref:u,className:"w-full h-24 border rounded-lg",width:600,height:100})}),e.jsxs("div",{className:"relative mt-2",children:[e.jsx("div",{className:E("absolute inset-0 rounded-2xl border-2 transition-all duration-300 ease-in-out",{"border-red-500 scale-110 opacity-70":s,"border-transparent scale-100 opacity-0":!s})}),e.jsx("div",{className:E("absolute inset-0 rounded-2xl border-2 transition-all duration-300 ease-in-out delay-150",{"border-red-400 scale-125 opacity-50":s,"border-transparent scale-100 opacity-0":!s})}),e.jsx(g,{variant:"ghost",className:E("rounded-2xl relative z-10 transition-colors duration-300",{"hover:bg-red-500 hover:text-primary-foreground":s,"hover:bg-primary hover:text-primary-foreground":!s},s?"bg-red-100 text-red-500":""),onClick:s?_:U,children:e.jsx(W,{width:68,height:68})})]}),e.jsxs("div",{className:"mt-6 w-full flex flex-col items-center",children:[e.jsx("audio",{ref:o,src:D,className:"hidden",children:e.jsx("track",{kind:"captions",srcLang:"ko",label:"Korean captions"})}),e.jsxs("section",{className:"flex items-center justify-center gap-2",children:[e.jsx(g,{variant:"outline",className:"rounded-full p-2 w-12 h-12 flex items-center justify-center",onClick:T,children:e.jsx(H,{size:24})}),h(v).with(w.union("ENDED","PAUSED"),()=>e.jsx(g,{variant:"outline",className:"rounded-full p-2 w-12 h-12 flex items-center justify-center",onClick:B,disabled:v==="PLAYING"||!D,children:e.jsx(K,{size:24})})).with("PLAYING",()=>e.jsx(g,{variant:"outline",className:"rounded-full p-2 w-12 h-12 flex items-center justify-center",onClick:I,children:e.jsx(F,{size:24})})).exhaustive()]}),e.jsx("p",{className:"text-sm text-gray-500 mt-2",children:h(v).with("ENDED",()=>"오디오 재생이 끝났습니다.").with("PLAYING",()=>"오디오가 재생 중입니다.").with("PAUSED",()=>"오디오가 일시 정지되었습니다.").otherwise(()=>"")})]})]})};export{re as RecRoom};
